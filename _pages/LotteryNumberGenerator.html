---
layout: page
title: 彩票选号助手
---
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>彩票选号助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        // 添加全局错误处理
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
            // 在页面上显示错误信息（仅开发环境）
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'position:fixed;top:0;left:0;right:0;background:red;color:white;padding:10px;z-index:9999;';
                errorDiv.textContent = 'JavaScript Error: ' + e.error.message;
                document.body.appendChild(errorDiv);
            }
        });

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        red: {
                            ball: '#f54545',
                            ballHover: '#e03535',
                        },
                        blue: {
                            ball: '#3b7fff',
                            ballHover: '#2b6fee',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-[#1b1b1e] text-gray-100 dark:bg-[#1b1b1e] dark:text-gray-100">
    <div class="min-h-screen flex flex-col">

        <!-- 主内容区 -->
        <main class="flex-grow container mx-auto px-4 py-6 md:py-10 animate-fade-in">
            <div class="max-w-4xl mx-auto bg-gray-800 rounded-xl shadow-md overflow-hidden transition-all hover:shadow-lg">
                <div class="p-6 md:p-8">
                    <!-- 选项卡 -->
                    <div class="flex mb-6 border-b border-gray-200">
                        <button id="tabDaletou" class="tab-button active py-2 px-4 font-medium text-primary-400 border-b-2 border-primary-400">
                            大乐透
                        </button>
                        <button id="tabShuangseqiu" class="tab-button py-2 px-4 font-medium text-gray-300 hover:text-primary-400">
                            双色球
                        </button>
                    </div>

                    <!-- 选择表单 -->
                    <div class="space-y-6">
                        <!-- 投注模式选择 -->
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-200 mb-2">选择投注模式</label>
                            <div class="flex flex-wrap gap-2">
                                <button id="modeSimple" class="mode-button active px-4 py-2 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors">
                                    普通投注
                                </button>
                                <button id="modeMultiple" class="mode-button px-4 py-2 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors">
                                    复式投注
                                </button>
                                <button id="modeDantuo" class="mode-button px-4 py-2 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors">
                                    胆拖投注
                                </button>
                            </div>
                        </div>

                        <!-- 注数选择（普通投注专用） -->
                        <div id="simpleOptions" class="form-group">
                            <label class="block text-sm font-medium text-gray-200 mb-2">注数</label>
                            <div class="flex items-center">
                                <input id="betCount" type="number" min="1" max="10" value="1" class="w-20 p-2 border border-gray-600 rounded-md bg-gray-700 text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500">
                                <span class="ml-2 text-sm text-gray-300">注</span>
                            </div>
                        </div>

                        <!-- 复式投注选项 -->
                        <div id="multipleOptions" class="form-group hidden space-y-4">
                            <div>
                                <label id="frontLabel" class="block text-sm font-medium text-gray-200 mb-2">前区号码数量 (5-7)</label>
                                <input id="frontCount" type="number" min="5" max="7" value="6" class="w-20 p-2 border border-gray-600 rounded-md bg-gray-700 text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500">
                            </div>
                            <div>
                                <label id="backLabel" class="block text-sm font-medium text-gray-200 mb-2">后区号码数量 (2-3)</label>
                                <input id="backCount" type="number" min="2" max="3" value="2" class="w-20 p-2 border border-gray-600 rounded-md bg-gray-700 text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500">
                            </div>
                        </div>

                        <!-- 胆拖投注选项 -->
                        <div id="dantuoOptions" class="form-group hidden space-y-4">
                            <div>
                                <label id="danLabel" class="block text-sm font-medium text-gray-200 mb-2">胆码数量 (1-4)</label>
                                <input id="danCount" type="number" min="1" max="4" value="1" class="w-20 p-2 border border-gray-600 rounded-md bg-gray-700 text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500">
                            </div>
                            <div>
                                <label id="tuoLabel" class="block text-sm font-medium text-gray-200 mb-2">拖码数量 (2-16)</label>
                                <input id="tuoCount" type="number" min="2" max="16" value="6" class="w-20 p-2 border border-gray-600 bg-gray-700 text-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500">
                            </div>
                        </div>

                        <!-- 生成按钮 -->
                        <div class="mt-6">
                            <button id="generateBtn" class="w-full sm:w-auto px-6 py-3 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded-md shadow-sm hover:shadow transition-all transform hover:scale-105 flex items-center justify-center">
                                <i class="fas fa-random mr-2"></i>生成号码
                            </button>
                        </div>
                    </div>

                    <!-- 号码展示区域 -->
                    <div id="resultsContainer" class="mt-8 hidden animate-fade-in">
                        <h3 class="text-lg font-medium text-gray-200 mb-4">生成结果</h3>
                        <div id="resultsContent" class="space-y-4"></div>
                    </div>
                </div>
            </div>
        </main>

    </div>

    <script>
        // 确保DOM完全加载后再执行脚本
        function initLotteryGenerator() {
            console.log('初始化彩票生成器...');
            
            try {
                // 检查必要的DOM元素是否存在
                const requiredElements = [
                    'tabDaletou', 'tabShuangseqiu', 'modeSimple', 'modeMultiple', 
                    'modeDantuo', 'generateBtn', 'resultsContainer', 'resultsContent'
                ];
                
                const missingElements = requiredElements.filter(id => !document.getElementById(id));
                if (missingElements.length > 0) {
                    console.error('缺少必要的DOM元素:', missingElements);
                    return;
                }
                
                console.log('所有必要的DOM元素都存在，开始初始化...');
                
                updateLotteryLimits();
                
                // 选项卡切换
                const tabs = document.querySelectorAll('.tab-button');
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        console.log('切换选项卡:', tab.id);
                        tabs.forEach(t => {
                            t.classList.remove('active', 'text-primary-400', 'border-b-2', 'border-primary-400');
                            t.classList.add('text-gray-300');
                        });
                        tab.classList.add('active', 'text-primary-400', 'border-b-2', 'border-primary-400');
                        tab.classList.remove('text-gray-300');
                        
                        // 更新表单限制
                        updateLotteryLimits();
                        // 清除之前的结果
                        hideResults();
                    });
                });

                // 投注模式切换
                const modes = document.querySelectorAll('.mode-button');
                const simpleOptions = document.getElementById('simpleOptions');
                const multipleOptions = document.getElementById('multipleOptions');
                const dantuoOptions = document.getElementById('dantuoOptions');
                
                modes.forEach(mode => {
                    mode.addEventListener('click', () => {
                        console.log('切换投注模式:', mode.id);
                        modes.forEach(m => {
                            m.classList.remove('active', 'bg-primary-800', 'text-primary-300');
                        });
                        mode.classList.add('active', 'bg-primary-800', 'text-primary-300');
                        
                        // 隐藏所有选项
                        simpleOptions.classList.add('hidden');
                        multipleOptions.classList.add('hidden');
                        dantuoOptions.classList.add('hidden');
                        
                        // 显示对应选项
                        if (mode.id === 'modeSimple') {
                            simpleOptions.classList.remove('hidden');
                        } else if (mode.id === 'modeMultiple') {
                            multipleOptions.classList.remove('hidden');
                        } else if (mode.id === 'modeDantuo') {
                            dantuoOptions.classList.remove('hidden');
                            updateTuoCount();
                        }
                        
                        // 清除之前的结果
                        hideResults();
                    });
                });

                // 生成号码按钮点击事件
                const generateBtn = document.getElementById('generateBtn');
                generateBtn.addEventListener('click', () => {
                    console.log('点击生成按钮');
                    generateNumbers();
                    
                    // 添加复制按钮和导出功能
                    setTimeout(() => {
                        addCopyButtonToResults();
                        addExportButton();
                        addAnalysisButton();
                    }, 100);
                });
                
                // 添加输入值变化时的限制检查
                const inputs = ['frontCount', 'backCount', 'danCount', 'tuoCount', 'betCount'];
                inputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('change', () => {
                            if (parseInt(input.value) < parseInt(input.min)) input.value = input.min;
                            if (parseInt(input.value) > parseInt(input.max)) input.value = input.max;
                        });
                    }
                });
                
                // 胆码数量变化时更新拖码限制
                const danCountInput = document.getElementById('danCount');
                if (danCountInput) {
                    danCountInput.addEventListener('change', updateTuoCount);
                }
                
                console.log('彩票生成器初始化完成');
                
            } catch (error) {
                console.error('初始化彩票生成器时出错:', error);
            }
        }

        // 根据彩票类型更新限制
        function updateLotteryLimits() {
            try {
                const isTabDaletou = document.getElementById('tabDaletou').classList.contains('active');
                const frontCountInput = document.getElementById('frontCount');
                const backCountInput = document.getElementById('backCount');
                const danCountInput = document.getElementById('danCount');
                const tuoCountInput = document.getElementById('tuoCount');
                const frontLabel = document.getElementById('frontLabel');
                const backLabel = document.getElementById('backLabel');
                const danLabel = document.getElementById('danLabel');
                
                if (!frontCountInput || !backCountInput || !danCountInput || !tuoCountInput) {
                    console.error('找不到必要的输入元素');
                    return;
                }
                
                if (isTabDaletou) {
                    // 大乐透
                    frontCountInput.min = 5;
                    frontCountInput.max = 7;
                    backCountInput.min = 2;
                    backCountInput.max = 3;
                    danCountInput.max = 4;
                    
                    if (frontLabel) frontLabel.textContent = '前区号码数量 (5-7)';
                    if (backLabel) backLabel.textContent = '后区号码数量 (2-3)';
                    if (danLabel) danLabel.textContent = '胆码数量 (1-4)';
                } else {
                    // 双色球
                    frontCountInput.min = 6;
                    frontCountInput.max = 12;
                    backCountInput.min = 1;
                    backCountInput.max = 16;
                    danCountInput.max = 5;
                    
                    if (frontLabel) frontLabel.textContent = '红球号码数量 (6-12)';
                    if (backLabel) backLabel.textContent = '蓝球号码数量 (1-16)';
                    if (danLabel) danLabel.textContent = '胆码数量 (1-5)';
                }
                
                // 确保当前值在新范围内
                if (frontCountInput.value < frontCountInput.min) frontCountInput.value = frontCountInput.min;
                if (frontCountInput.value > frontCountInput.max) frontCountInput.value = frontCountInput.max;
                if (backCountInput.value < backCountInput.min) backCountInput.value = backCountInput.min;
                if (backCountInput.value > backCountInput.max) backCountInput.value = backCountInput.max;
                if (danCountInput.value > danCountInput.max) danCountInput.value = danCountInput.max;
                
                updateTuoCount();
            } catch (error) {
                console.error('更新彩票限制时出错:', error);
            }
        }

        // 更新拖码数量限制
        function updateTuoCount() {
            try {
                const isTabDaletou = document.getElementById('tabDaletou').classList.contains('active');
                const danCountInput = document.getElementById('danCount');
                const tuoCountInput = document.getElementById('tuoCount');
                const tuoLabel = document.getElementById('tuoLabel');
                
                if (!danCountInput || !tuoCountInput) {
                    console.error('找不到胆码或拖码输入元素');
                    return;
                }
                
                const danCount = parseInt(danCountInput.value);
                
                if (isTabDaletou) {
                    // 大乐透前区需要 5 个数字
                    tuoCountInput.min = Math.max(1, 5 - danCount);
                    tuoCountInput.max = 35 - danCount;  // 大乐透前区总共35个数字
                } else {
                    // 双色球红球需要 6 个数字
                    tuoCountInput.min = Math.max(1, 6 - danCount);
                    tuoCountInput.max = 33 - danCount;  // 双色球红球总共33个数字
                }
                
                if (tuoLabel) tuoLabel.textContent = `拖码数量 (${tuoCountInput.min}-${tuoCountInput.max})`;
                
                if (parseInt(tuoCountInput.value) < parseInt(tuoCountInput.min)) {
                    tuoCountInput.value = tuoCountInput.min;
                }
                if (parseInt(tuoCountInput.value) > parseInt(tuoCountInput.max)) {
                    tuoCountInput.value = tuoCountInput.max;
                }
            } catch (error) {
                console.error('更新拖码数量限制时出错:', error);
            }
        }

        // 生成随机号码
        function generateRandomNumber(min, max, exclude = []) {
            let num;
            do {
                num = Math.floor(Math.random() * (max - min + 1)) + min;
            } while (exclude.includes(num));
            return num;
        }
        
        function generateNumbers() {
            try {
                console.log('开始生成号码...');
                const isTabDaletou = document.getElementById('tabDaletou').classList.contains('active');
                const activeMode = document.querySelector('.mode-button.active');
                
                if (!activeMode) {
                    console.error('找不到活动的投注模式');
                    return;
                }
                
                const resultsContent = document.getElementById('resultsContent');
                if (!resultsContent) {
                    console.error('找不到结果容器');
                    return;
                }
                
                resultsContent.innerHTML = '';
                
                let count = 1;
                if (activeMode.id === 'modeSimple') {
                    const betCountInput = document.getElementById('betCount');
                    if (betCountInput) {
                        count = parseInt(betCountInput.value);
                    }
                }
                
                console.log('生成', count, '注号码，彩票类型:', isTabDaletou ? '大乐透' : '双色球', '模式:', activeMode.id);
                
                for (let i = 0; i < count; i++) {
                    if (isTabDaletou) {
                        generateDaletouNumbers(activeMode.id, i + 1);
                    } else {
                        generateShuangseqiuNumbers(activeMode.id, i + 1);
                    }
                }
                
                // 显示结果区域
                const resultsContainer = document.getElementById('resultsContainer');
                if (resultsContainer) {
                    resultsContainer.classList.remove('hidden');
                    // 平滑滚动到结果区域
                    resultsContainer.scrollIntoView({ behavior: 'smooth' });
                }
                
                console.log('号码生成完成');
            } catch (error) {
                console.error('生成号码时出错:', error);
            }
        }
        
        function generateDaletouNumbers(mode, groupNumber = 1) {
            try {
                const frontMax = 35;
                const backMax = 12;
                let frontNumbers = [];
                let backNumbers = [];
                let resultHTML = '';
                
                if (mode === 'modeDantuo') {
                    const danCount = parseInt(document.getElementById('danCount').value);
                    const tuoCount = parseInt(document.getElementById('tuoCount').value);
                    
                    // 生成胆码
                    for (let i = 0; i < danCount; i++) {
                        frontNumbers.push(generateRandomNumber(1, frontMax, frontNumbers));
                    }
                    
                    // 生成拖码
                    for (let i = 0; i < tuoCount; i++) {
                        frontNumbers.push(generateRandomNumber(1, frontMax, frontNumbers));
                    }
                    
                    // 生成后区号码
                    for (let i = 0; i < 2; i++) {
                        backNumbers.push(generateRandomNumber(1, backMax, backNumbers));
                    }
                    
                    resultHTML = createDantuoBallsHTML(frontNumbers, backNumbers, danCount);
                } else if (mode === 'modeMultiple') {
                    const frontCount = parseInt(document.getElementById('frontCount').value);
                    const backCount = parseInt(document.getElementById('backCount').value);
                    
                    // 生成前区号码
                    for (let i = 0; i < frontCount; i++) {
                        frontNumbers.push(generateRandomNumber(1, frontMax, frontNumbers));
                    }
                    
                    // 生成后区号码
                    for (let i = 0; i < backCount; i++) {
                        backNumbers.push(generateRandomNumber(1, backMax, backNumbers));
                    }
                    
                    resultHTML = createBallsHTML(frontNumbers, backNumbers);
                } else {
                    // 普通投注模式
                    for (let i = 0; i < 5; i++) {
                        frontNumbers.push(generateRandomNumber(1, frontMax, frontNumbers));
                    }
                    
                    for (let i = 0; i < 2; i++) {
                        backNumbers.push(generateRandomNumber(1, backMax, backNumbers));
                    }
                    
                    resultHTML = createBallsHTML(frontNumbers, backNumbers);
                }
                
                displayResult('大乐透', mode, resultHTML, groupNumber);
            } catch (error) {
                console.error('生成大乐透号码时出错:', error);
            }
        }
        
        function generateShuangseqiuNumbers(mode, groupNumber = 1) {
            try {
                const redMax = 33;
                const blueMax = 16;
                let redNumbers = [];
                let blueNumbers = [];
                let resultHTML = '';
                
                if (mode === 'modeDantuo') {
                    const danCount = parseInt(document.getElementById('danCount').value);
                    const tuoCount = parseInt(document.getElementById('tuoCount').value);
                    
                    // 生成胆码
                    for (let i = 0; i < danCount; i++) {
                        redNumbers.push(generateRandomNumber(1, redMax, redNumbers));
                    }
                    
                    // 生成拖码
                    for (let i = 0; i < tuoCount; i++) {
                        redNumbers.push(generateRandomNumber(1, redMax, redNumbers));
                    }
                    
                    // 生成蓝球
                    blueNumbers.push(generateRandomNumber(1, blueMax));
                    
                    resultHTML = createDantuoBallsHTML(redNumbers, blueNumbers, danCount);
                } else if (mode === 'modeMultiple') {
                    const redCount = parseInt(document.getElementById('frontCount').value);
                    const blueCount = parseInt(document.getElementById('backCount').value);
                    
                    // 生成红球
                    for (let i = 0; i < redCount; i++) {
                        redNumbers.push(generateRandomNumber(1, redMax, redNumbers));
                    }
                    
                    // 生成蓝球
                    for (let i = 0; i < blueCount; i++) {
                        blueNumbers.push(generateRandomNumber(1, blueMax, blueNumbers));
                    }
                    
                    resultHTML = createBallsHTML(redNumbers, blueNumbers);
                } else {
                    // 普通投注模式
                    for (let i = 0; i < 6; i++) {
                        redNumbers.push(generateRandomNumber(1, redMax, redNumbers));
                    }
                    
                    blueNumbers.push(generateRandomNumber(1, blueMax));
                    
                    resultHTML = createBallsHTML(redNumbers, blueNumbers);
                }
                
                displayResult('双色球', mode, resultHTML, groupNumber);
            } catch (error) {
                console.error('生成双色球号码时出错:', error);
            }
        }
        
        function createBallsHTML(frontNumbers, backNumbers) {
            frontNumbers.sort((a, b) => a - b);
            backNumbers.sort((a, b) => a - b);
            
            let html = '<div class="flex flex-wrap items-center gap-2 mb-2">';
            
            // 前区号码
            frontNumbers.forEach(num => {
                html += `<div class="ball-red w-10 h-10 flex items-center justify-center rounded-full bg-red-ball text-white font-medium text-sm transition-transform hover:scale-110">${num.toString().padStart(2, '0')}</div>`;
            });
            
            // 分隔符
            html += '<div class="mx-2 text-gray-400">+</div>';
            
            // 后区号码
            backNumbers.forEach(num => {
                html += `<div class="ball-blue w-10 h-10 flex items-center justify-center rounded-full bg-blue-ball text-white font-medium text-sm transition-transform hover:scale-110">${num.toString().padStart(2, '0')}</div>`;
            });
            
            html += '</div>';
            return html;
        }
        
        function createDantuoBallsHTML(frontNumbers, backNumbers, danCount) {
            const danNumbers = frontNumbers.slice(0, danCount).sort((a, b) => a - b);
            const tuoNumbers = frontNumbers.slice(danCount).sort((a, b) => a - b);
            backNumbers.sort((a, b) => a - b);
            
            let html = '<div class="space-y-3">';
            
            // 胆码
            html += '<div class="flex items-center gap-2"><span class="text-sm font-medium w-12">胆码：</span><div class="flex flex-wrap gap-2">';
            danNumbers.forEach(num => {
                html += `<div class="ball-red w-10 h-10 flex items-center justify-center rounded-full bg-red-ball text-white font-medium text-sm transition-transform hover:scale-110">${num.toString().padStart(2, '0')}</div>`;
            });
            html += '</div></div>';
            
            // 拖码
            html += '<div class="flex items-center gap-2"><span class="text-sm font-medium w-12">拖码：</span><div class="flex flex-wrap gap-2">';
            tuoNumbers.forEach(num => {
                html += `<div class="ball-red w-10 h-10 flex items-center justify-center rounded-full bg-red-ball text-white font-medium text-sm transition-transform hover:scale-110">${num.toString().padStart(2, '0')}</div>`;
            });
            html += '</div></div>';
            
            // 后区
            html += '<div class="flex items-center gap-2"><span class="text-sm font-medium w-12">后区：</span><div class="flex flex-wrap gap-2">';
            backNumbers.forEach(num => {
                html += `<div class="ball-blue w-10 h-10 flex items-center justify-center rounded-full bg-blue-ball text-white font-medium text-sm transition-transform hover:scale-110">${num.toString().padStart(2, '0')}</div>`;
            });
            html += '</div></div>';
            
            html += '</div>';
            return html;
        }
        
        function displayResult(lotteryType, mode, resultHTML, groupNumber) {
            try {
                const resultsContent = document.getElementById('resultsContent');
                if (!resultsContent) {
                    console.error('找不到结果内容容器');
                    return;
                }
                
                let modeText = '普通投注';
                if (mode === 'modeMultiple') modeText = '复式投注';
                if (mode === 'modeDantuo') modeText = '胆拖投注';
                
                const activeMode = document.querySelector('.mode-button.active');
                const betCountInput = document.getElementById('betCount');
                const groupTag = activeMode && activeMode.id === 'modeSimple' && betCountInput && parseInt(betCountInput.value) > 1
                    ? `<span class="text-xs font-medium ml-2 px-2 py-0.5 bg-gray-700 rounded">第 ${groupNumber} 注</span>`
                    : '';
                
                const resultCard = document.createElement('div');
                resultCard.className = 'p-4 bg-gray-800 rounded-lg border border-gray-700 animate-fade-in';
                resultCard.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="text-base font-medium text-gray-200">${lotteryType} · ${modeText}${groupTag}</h4>
                        <span class="text-xs text-gray-400">${new Date().toLocaleString('zh-CN', {hour12: false})}</span>
                    </div>
                    ${resultHTML}
                `;
                
                resultsContent.appendChild(resultCard);
                console.log('显示结果:', lotteryType, modeText);
            } catch (error) {
                console.error('显示结果时出错:', error);
            }
        }
        
        function hideResults() {
            try {
                const resultsContainer = document.getElementById('resultsContainer');
                const resultsContent = document.getElementById('resultsContent');
                if (resultsContainer) resultsContainer.classList.add('hidden');
                if (resultsContent) resultsContent.innerHTML = '';
            } catch (error) {
                console.error('隐藏结果时出错:', error);
            }
        }
        
        // 添加复制功能
        function addCopyButtonToResults() {
            try {
                const resultCards = document.querySelectorAll('#resultsContent > div');
                resultCards.forEach(card => {
                    // 防止重复添加
                    if (card.querySelector('.copy-btn')) return;
                    
                    card.classList.add('result-card', 'relative');
                    
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'copy-btn absolute top-4 right-4 p-1.5 bg-gray-800 rounded-md hover:bg-gray-700 transition-colors';
                    copyBtn.innerHTML = '<i class="far fa-copy"></i>';
                    copyBtn.title = '复制号码';
                    
                    copyBtn.addEventListener('click', () => {
                        try {
                            // 提取号码文本
                            let numbers = '';
                            const ballElements = card.querySelectorAll('.ball-red, .ball-blue');
                            ballElements.forEach((ball, index) => {
                                numbers += ball.textContent;
                                if (index < ballElements.length - 1) {
                                    numbers += ' ';
                                }
                            });
                            
                            // 复制到剪贴板
                            if (navigator.clipboard) {
                                navigator.clipboard.writeText(numbers).then(() => {
                                    copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                                    setTimeout(() => {
                                        copyBtn.innerHTML = '<i class="far fa-copy"></i>';
                                    }, 2000);
                                }).catch(err => {
                                    console.error('复制失败:', err);
                                    // 降级方案
                                    const textArea = document.createElement('textarea');
                                    textArea.value = numbers;
                                    document.body.appendChild(textArea);
                                    textArea.select();
                                    document.execCommand('copy');
                                    document.body.removeChild(textArea);
                                    copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                                    setTimeout(() => {
                                        copyBtn.innerHTML = '<i class="far fa-copy"></i>';
                                    }, 2000);
                                });
                            } else {
                                // 降级方案
                                const textArea = document.createElement('textarea');
                                textArea.value = numbers;
                                document.body.appendChild(textArea);
                                textArea.select();
                                document.execCommand('copy');
                                document.body.removeChild(textArea);
                                copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                                setTimeout(() => {
                                    copyBtn.innerHTML = '<i class="far fa-copy"></i>';
                                }, 2000);
                            }
                        } catch (error) {
                            console.error('复制功能出错:', error);
                        }
                    });
                    
                    card.appendChild(copyBtn);
                });
            } catch (error) {
                console.error('添加复制按钮时出错:', error);
            }
        }
        
        // 添加导出功能
        function addExportButton() {
            try {
                const resultsContainer = document.getElementById('resultsContainer');
                if (!resultsContainer.querySelector('#exportBtn')) {
                    const exportBtn = document.createElement('button');
                    exportBtn.id = 'exportBtn';
                    exportBtn.className = 'mt-4 px-4 py-2 bg-gray-700 text-gray-300 rounded-md hover:bg-gray-600 transition-colors flex items-center';
                    exportBtn.innerHTML = '<i class="fas fa-download mr-2"></i>导出结果';
                    
                    exportBtn.addEventListener('click', () => {
                        try {
                            let exportText = '';
                            const resultCards = document.querySelectorAll('#resultsContent > div');
                            
                            resultCards.forEach(card => {
                                const header = card.querySelector('h4');
                                const timestamp = card.querySelector('.text-xs.text-gray-400');
                                
                                if (header) exportText += `${header.textContent}`;
                                if (timestamp) exportText += ` (${timestamp.textContent})\n`;
                                
                                // 胆拖投注特殊处理
                                if (header && header.textContent.includes('胆拖')) {
                                    const sections = card.querySelectorAll('.flex.items-center.gap-2');
                                    sections.forEach(section => {
                                        const label = section.querySelector('span.text-sm.font-medium');
                                        const balls = section.querySelectorAll('.ball-red, .ball-blue');
                                        if (label) exportText += `${label.textContent} `;
                                        let ballText = '';
                                        balls.forEach(ball => {
                                            ballText += ball.textContent + ' ';
                                        });
                                        exportText += ballText.trim() + '\n';
                                    });
                                } else {
                                    // 普通和复式投注
                                    const balls = card.querySelectorAll('.ball-red, .ball-blue');
                                    let ballText = '';
                                    balls.forEach(ball => {
                                        ballText += ball.textContent + ' ';
                                    });
                                    exportText += ballText.trim() + '\n';
                                }
                                
                                exportText += '\n';
                            });
                            
                            // 创建一个临时的a标签来下载
                            const blob = new Blob([exportText], { type: 'text/plain' });
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = `彩票号码_${new Date().toISOString().slice(0, 10)}.txt`;
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            URL.revokeObjectURL(url);

                            // 显示导出成功提示
                            const oldText = exportBtn.innerHTML;
                            exportBtn.innerHTML = '<i class="fas fa-check mr-2"></i>导出成功';
                            setTimeout(() => {
                                exportBtn.innerHTML = oldText;
                            }, 2000);
                        } catch (error) {
                            console.error('导出功能出错:', error);
                        }
                    });
                    
                    resultsContainer.appendChild(exportBtn);
                }
            } catch (error) {
                console.error('添加导出按钮时出错:', error);
            }
        }
        
        // 实现号码分析功能
        function analyzeNumbers() {
            try {
                const isTabDaletou = document.getElementById('tabDaletou').classList.contains('active');
                const resultsContent = document.getElementById('resultsContent');
                const resultCards = resultsContent.querySelectorAll('.result-card');
                
                if (resultCards.length < 2) return; // 需要至少两组号码才能分析
                
                // 创建分析结果卡片
                const analysisCard = document.createElement('div');
                analysisCard.className = 'p-4 bg-gray-900 rounded-lg border border-gray-700 animate-fade-in mt-4';
                
                // 收集数字出现频率
                const frontFrequency = {};
                const backFrequency = {};
                
                resultCards.forEach(card => {
                    const redBalls = card.querySelectorAll('.ball-red');
                    const blueBalls = card.querySelectorAll('.ball-blue');
                    
                    redBalls.forEach(ball => {
                        const num = parseInt(ball.textContent);
                        frontFrequency[num] = (frontFrequency[num] || 0) + 1;
                    });
                    
                    blueBalls.forEach(ball => {
                        const num = parseInt(ball.textContent);
                        backFrequency[num] = (backFrequency[num] || 0) + 1;
                    });
                });
                
                // 找出最常出现的号码
                const mostFrequentFront = Object.keys(frontFrequency).sort((a, b) => frontFrequency[b] - frontFrequency[a]).slice(0, 5);
                const mostFrequentBack = Object.keys(backFrequency).sort((a, b) => backFrequency[b] - frontFrequency[a]).slice(0, 2);
                
                // 创建分析结果HTML
                let analysisHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="text-base font-medium text-gray-200">号码分析结果</h4>
                        <span class="text-xs text-gray-400">${new Date().toLocaleString('zh-CN', {hour12: false})}</span>
                    </div>
                    <div class="space-y-3">
                        <div>
                            <p class="text-sm font-medium mb-2 text-gray-300">出现频率最高的${isTabDaletou ? '前区' : '红球'}号码：</p>
                            <div class="flex flex-wrap gap-2">
                `;
                
                mostFrequentFront.forEach(num => {
                    analysisHTML += `
                        <div class="flex flex-col items-center">
                            <div class="ball-red w-10 h-10 flex items-center justify-center rounded-full bg-red-ball text-white font-medium text-sm">${num.toString().padStart(2, '0')}</div>
                            <span class="text-xs mt-1 text-gray-300">${frontFrequency[num]}次</span>
                        </div>
                    `;
                });
                
                analysisHTML += `
                        </div>
                    </div>
                    <div>
                        <p class="text-sm font-medium mb-2 text-gray-300">出现频率最高的${isTabDaletou ? '后区' : '蓝球'}号码：</p>
                        <div class="flex flex-wrap gap-2">
                `;
                
                mostFrequentBack.forEach(num => {
                    analysisHTML += `
                        <div class="flex flex-col items-center">
                            <div class="ball-blue w-10 h-10 flex items-center justify-center rounded-full bg-blue-ball text-white font-medium text-sm">${num.toString().padStart(2, '0')}</div>
                            <span class="text-xs mt-1 text-gray-300">${backFrequency[num]}次</span>
                        </div>
                    `;
                });
                
                analysisHTML += `
                        </div>
                    </div>
                </div>
                `;
                
                analysisCard.innerHTML = analysisHTML;
                resultsContent.appendChild(analysisCard);
            } catch (error) {
                console.error('分析号码时出错:', error);
            }
        }
        
        // 仅在有足够的结果时才显示分析按钮
        function addAnalysisButton() {
            try {
                const resultsContainer = document.getElementById('resultsContainer');
                const resultCards = document.querySelectorAll('#resultsContent > div');
                
                if (resultCards.length >= 2 && !resultsContainer.querySelector('#analysisBtn')) {
                    const analysisBtn = document.createElement('button');
                    analysisBtn.id = 'analysisBtn';
                    analysisBtn.className = 'mt-4 mr-2 px-4 py-2 bg-primary-800 text-primary-300 rounded-md hover:bg-primary-700 transition-colors flex items-center';
                    analysisBtn.innerHTML = '<i class="fas fa-chart-bar mr-2"></i>分析号码';
                    
                    analysisBtn.addEventListener('click', () => {
                        analyzeNumbers();
                        analysisBtn.disabled = true;
                        analysisBtn.className = 'mt-4 mr-2 px-4 py-2 bg-gray-700 text-gray-500 rounded-md cursor-not-allowed flex items-center';
                        analysisBtn.innerHTML = '<i class="fas fa-chart-bar mr-2"></i>已分析';
                    });
                    
                    const exportBtn = document.getElementById('exportBtn');
                    if (exportBtn) {
                        resultsContainer.insertBefore(analysisBtn, exportBtn);
                    } else {
                        resultsContainer.appendChild(analysisBtn);
                    }
                }
            } catch (error) {
                console.error('添加分析按钮时出错:', error);
            }
        }
        
        // 添加一些自定义样式
        const style = document.createElement('style');
        style.textContent = `
            .ball-red:hover {
                background-color: #e03535;
            }
            .ball-blue:hover {
                background-color: #2b6fee;
            }
            .tab-button.active {
                font-weight: 600;
            }
            .mode-button.active {
                font-weight: 500;
            }
            
            /* 添加一些平滑过渡动画 */
            .animate-fade-in {
                animation: fadeIn 0.5s ease-out;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            /* 移动端适配优化 */
            @media (max-width: 640px) {
                .ball-red, .ball-blue {
                    width: 2rem;
                    height: 2rem;
                    font-size: 0.75rem;
                }
            }
            
            /* 懒加载效果 */
            .lazy-load {
                opacity: 0;
                transform: translateY(20px);
                transition: opacity 0.5s ease, transform 0.5s ease;
            }
            
            .lazy-load.loaded {
                opacity: 1;
                transform: translateY(0);
            }
            
            /* 复制按钮样式 */
            .copy-btn {
                opacity: 0;
                transition: opacity 0.2s ease;
            }
            
            .result-card:hover .copy-btn {
                opacity: 1;
            }
        `;
        document.head.appendChild(style);
        
        // 添加自动检测系统主题变化的功能
        if (window.matchMedia) {
            const colorSchemeQuery = window.matchMedia('(prefers-color-scheme: dark)');
            colorSchemeQuery.addEventListener('change', (e) => {
                if (e.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });
        }
        
        // 实现懒加载效果
        function initLazyLoad() {
            const lazyElements = document.querySelectorAll('.lazy-load');
            
            const lazyLoadObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('loaded');
                        observer.unobserve(entry.target);
                    }
                });
            });
            
            lazyElements.forEach(element => {
                lazyLoadObserver.observe(element);
            });
        }
        
        // 确保DOM完全加载后再初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initLotteryGenerator);
        } else {
            // DOM已经加载完成
            initLotteryGenerator();
        }
        
        // 页面加载完成后初始化懒加载
        window.addEventListener('load', initLazyLoad);
    </script>
</body>
</html>